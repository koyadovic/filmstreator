{% extends "web/base.html" %}
{% load static %}
{% block title %}Filmstreator{% endblock %}

{% block body %}

<nav class="notbody navbar top-navbar top-nav">
    <a class="text_with_2px_border navbar-brand" href="/">Filmstreator</a>
</nav>

{% if genres_names %}
{#<nav class="navbar navbar-default navbar-static-top second-nav {{ context_class }}">#}

{#    {% for genres_name in genres_names %}#}
{#        {% if forloop.counter < 6 %}#}
{#        <li class="nav-item{% if genres_name == current_genre %} active{% endif %}">#}
{#            <a class="nav-link" href="/genres/{{ genres_name }}/">{{ genres_name }}<span class="sr-only">(current)</span></a>#}
{#        </li>#}
{#        {% endif %}#}
{#    {% endfor %}#}
{##}
{#    {% if genres_names|length > 5 %}#}
{##}
{#    <li class="nav-item dropdown">#}
{#        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">#}
{#            More#}
{#        </a>#}
{#        <div class="dropdown-menu" aria-labelledby="navbarDropdown">#}
{#            {% for genres_name in genres_names %}#}
{#                {% if forloop.counter > 5 %}#}
{#                <a class="dropdown-item{% if genres_name == current_genre %} active{% endif %}" href="/genres/{{ genres_name }}/">{{ genres_name }}</a>#}
{#                {% endif %}#}
{#            {% endfor %}#}
{#        </div>#}
{#    </li>#}
{#    {% endif %}#}
{#</nav>#}
{% endif %}

{% if is_landing %}
<div class="wrapper">
    <section class="content">
{% endif %}
    <div class="main-container {% if is_landing %}container-fluid{% else %}container{% endif %}">
        {% block content %}{% endblock %}
    </div>
{% if is_landing %}
    </section>
    <nav class="sidebar">
    {% include 'web/fragment_landing_filters.html' %}
        <br>

    <h5 class="text-center">Explore all genres</h5>
    <hr>
    <div id="accordion">
    {% for genres_name in genres_names %}
        <div class="">
            <div class="nav-item" id="heading{{ genres_name }}">
                <h5 class="mb-0">
                <button class="genre-accordion-btn" data-toggle="collapse" data-target="#collapse{{ genres_name }}" aria-expanded="{% if genres_name in filter_params.genres__name__in %}true{% else %}false{% endif %}" aria-controls="collapse{{ genres_name }}">
                <i class="fa fa-chevron-down"></i> {{ genres_name }}
                </button>
                </h5>
            </div>

            <div id="collapse{{ genres_name }}" class="collapse{% if genres_name in filter_params.genres__name__in %} show{% endif %}" aria-labelledby="heading{{ genres_name }}" data-parent="#accordion">
                <div class="card-body">
                    <a class="genre-epoch-link{% if genres_name in filter_params.genres__name__in and filter_params.year__lte == '1979' %} active{% endif %}" href="/s/?ft=a&genres__name__in={{ genres_name }}&year__gte=1970&year__lte=1979&ordering=-global_score">
                        {% if genres_name in filter_params.genres__name__in and filter_params.year__lte == '1979' %}
                        <i class="fa fa-angle-right"></i>
                        {% endif %}
                        Best 70s {{ genres_name }} movies
                    </a>
                    <a class="genre-epoch-link{% if genres_name in filter_params.genres__name__in and filter_params.year__lte == '1989' %} active{% endif %}" href="/s/?ft=a&genres__name__in={{ genres_name }}&year__gte=1980&year__lte=1989&ordering=-global_score">
                        {% if genres_name in filter_params.genres__name__in and filter_params.year__lte == '1989' %}
                        <i class="fa fa-angle-right"></i>
                        {% endif %}
                        Best 80s {{ genres_name }} movies
                    </a>
                    <a class="genre-epoch-link{% if genres_name in filter_params.genres__name__in and filter_params.year__lte == '1999' %} active{% endif %}" href="/s/?ft=a&genres__name__in={{ genres_name }}&year__gte=1990&year__lte=1999&ordering=-global_score">
                        {% if genres_name in filter_params.genres__name__in and filter_params.year__lte == '1999' %}
                        <i class="fa fa-angle-right"></i>
                        {% endif %}
                        Best 90s {{ genres_name }} movies
                    </a>
                    <a class="genre-epoch-link{% if genres_name in filter_params.genres__name__in and filter_params.year__lte == '2009' %} active{% endif %}" href="/s/?ft=a&genres__name__in={{ genres_name }}&year__gte=2000&year__lte=2009&ordering=-global_score">
                        {% if genres_name in filter_params.genres__name__in and filter_params.year__lte == '2009' %}
                        <i class="fa fa-angle-right"></i>
                        {% endif %}
                        Best 2000s {{ genres_name }} movies
                    </a>
                    <a class="genre-epoch-link{% if genres_name in filter_params.genres__name__in and filter_params.year__lte == '2019' %} active{% endif %}" href="/s/?ft=a&genres__name__in={{ genres_name }}&year__gte=20100&year__lte=2019&ordering=-global_score">
                        {% if genres_name in filter_params.genres__name__in and filter_params.year__lte == '2019' %}
                        <i class="fa fa-angle-right"></i>
                        {% endif %}
                        Best 2010s {{ genres_name }} movies
                    </a>
                    <a class="genre-epoch-link{% if genres_name in filter_params.genres__name__in and filter_params.year__lte == '3000' %} active{% endif %}" href="/s/?ft=a&genres__name__in={{ genres_name }}&year__lte=3000&ordering=-global_score">
                        {% if genres_name in filter_params.genres__name__in and filter_params.year__lte == '3000' %}
                        <i class="fa fa-angle-right"></i>
                        {% endif %}
                        Best {{ genres_name }} movies all times
                    </a>
                </div>
            </div>
        </div>
    {% endfor %}
        <hr>
        <div class="">
            <div class="nav-item" id="headingadvancedsearch">
                <h5 class="mb-0">
                <button class="genre-accordion-btn" data-toggle="collapse" data-target="#collapseadvancedsearch" aria-expanded="false" aria-controls="collapseadvancedsearch">
                <i class="fa fa-chevron-down"></i> Advanced Search
                </button>
                </h5>
            </div>

            <div id="collapseadvancedsearch" class="collapse" aria-labelledby="headingadvancedsearch" data-parent="#accordion">
                <div class="card-body">
                {% include 'web/fragment_advanced_search.html' %}
                </div>
            </div>
        </div>
    </div>


    <br>
    </nav>
</div>
{% endif %}
<!-- footer -->
{#{% include 'web/fragment_footer.html' %}#}
{% endblock %}


{% block body_extra_js %}
<script>
$(document).ready(function () {
    $('#search-tooltip').tooltip();

    $('#advanced-search-form').on('submit', function (event) {
        event.preventDefault();
        var selectedGenresArray = [];
        $('#genres-select :selected').each(function(i, selected){
            selectedGenresArray.push($(selected).text());
        });
        var selectedGenres = selectedGenresArray.join(',');
        var searchSimilar = $("#advanced-search-form input[name=s]").val();
        var ordering = $("#advanced-search-form select[name=ordering]").val();
        var yearGte = $("#advanced-search-form select[name=year__gte]").val();
        var yearLte = $("#advanced-search-form select[name=year__lte]").val();

        var url = '/s/?ft=a';
        if(searchSimilar !== '') url += '&s=' + searchSimilar;
        if (selectedGenres !== '') url += '&genres__name__in=' + selectedGenres;
        url += '&year__gte=' + yearGte;
        url += '&year__lte=' + yearLte;
        url += '&ordering=' + ordering;
        window.location = url;
    });
});
</script>
{% endblock %}
