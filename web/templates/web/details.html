{% extends "web/base_with_menu_and_footer.html" %}
{% load static %}
{% load miscellaneous %}

{% block title %}Filmstreator - {{ audiovisual_record.name }} - Full Movie Download{% for lang, downloads, translation in lang_downloads %} - {{ translation }}{% endfor %}{% endblock %}

{% block head_extra %}
{{ block.super }}
<meta name="description" content="{% if audiovisual_record.summary %}{{ audiovisual_record.summary }}. {% endif %}{{ audiovisual_record.name }} was Writen by {{ audiovisual_record.writers | map:"name" | join:", " }} and directed by {{ audiovisual_record.directors | map:"name" | join:", " }} in the year {{ audiovisual_record.year }}.">
<meta property="og:title" content="{{ audiovisual_record.name }}{% for lang, downloads, translation in  lang_downloads %} {{ translation }}{% endfor %} Full Movie Downloads.">
<meta name="keywords" content="{{ audiovisual_record.name }} full movie download torrent magnet links{% for lang, downloads, translation in  lang_downloads %} {{ translation|lower }}{% endfor %}">
<meta property="og:type" content="video.movie" />
<meta property="og:url" content="{{ request.build_absolute_uri }}" />
<meta property="og:image" content="{{ audiovisual_record.images.0 }}" />
<link rel="canonical" href="/{{ audiovisual_record.slug }}/">
{% endblock %}

{% block content %}
    <div class="container">
        <br>
        <div class="row">
            <div class="filmcard-wrapper col-sm-5">
                <!-- name -->
                <div class="filmcard-title">
                    {% if audiovisual_record.name.50 %}
                    <h1>{{ audiovisual_record.name|truncatechars:50 }} ({{ audiovisual_record.year }}) {% if request.user.is_superuser %}<a href="#" onclick="removeFilm('{{ audiovisual_record.id }}');" style="color: white;" class="btn btn-secondary">Remove entire film</a>{% endif %}</h1>
                    {% else %}
                    <h1>{{ audiovisual_record.name }} ({{ audiovisual_record.year }}) {% if request.user.is_superuser %}<a href="#" onclick="removeFilm('{{ audiovisual_record.id }}');" style="color: white;" class="btn btn-secondary">Remove entire film</a>{% endif %}</h1>
                    {% endif %}
                </div>

                <div class="filmcard">
                    <div class="filmcard-body">
                        <div class="main-image">
                            <img style="height: 100%; width: 100%;" src="{{ audiovisual_record.images.0 }}" alt="Main cover of {{ audiovisual_record.name }}">
                        </div>

                        <h5>Genres:</h5>
                        {% if audiovisual_record.genres %}
                        <p>
                            {% for genre in audiovisual_record.genres %}
                                {% if forloop.last %}
                                    <a class="secondary" href="/s/?ft=a&genres__name__in={{ genre.name }}&ordering=-global_score"><b>{{ genre.name }}.</b></a>
                                {% else %}
                                    <a class="secondary" href="/s/?ft=a&genres__name__in={{ genre.name }}&ordering=-global_score"><b>{{ genre.name }}, </b></a>
                                {% endif %}
                            {% endfor %}
                        </p>
                        {% else %}
                        <p>Unavailable.</p>
                        {% endif %}

                        <h5>Directors:</h5>
                        {% if audiovisual_record.directors %}
                        <p>
                            {% for person in audiovisual_record.directors %}
                                {% if forloop.last %}
                                    <a class="secondary" href="{{ person.search_url }}">{{ person.name }}.</a>
                                {% else %}
                                    <a class="secondary" href="{{ person.search_url }}">{{ person.name }}, </a>
                                {% endif %}
                            {% endfor %}
                        </p>
                        {% else %}
                        <p>Unavailable.</p>
                        {% endif %}

                        <h5>Writers:</h5>
                        {% if audiovisual_record.writers %}
                        <p>
                            {% for person in audiovisual_record.writers %}
                                {% if forloop.last %}
                                    <a class="secondary" href="{{ person.search_url }}">{{ person.name }}.</a>
                                {% else %}
                                    <a class="secondary" href="{{ person.search_url }}">{{ person.name }}, </a>
                                {% endif %}
                            {% endfor %}
                        </p>
                        {% else %}
                        <p>Unavailable.</p>
                        {% endif %}

                        <h5>Stars:</h5>
                        {% if audiovisual_record.stars %}
                        <p>
                            {% for person in audiovisual_record.stars %}
                                {% if forloop.last %}
                                    <a class="secondary" href="{{ person.search_url }}">{{ person.name }}.</a>
                                {% else %}
                                    <a class="secondary" href="{{ person.search_url }}">{{ person.name }}, </a>
                                {% endif %}
                            {% endfor %}
                        </p>
                        {% else %}
                        <p>Unavailable.</p>
                        {% endif %}

                        {% if audiovisual_record.summary %}
                        <h5>Summary:</h5>
                        <p>{{ audiovisual_record.summary }}</p>
                        {% endif %}

                    </div>

                    <div class="filmcard-footer">
                        <hr>
                        {% for score in audiovisual_record.scores %}
                            <a href="{{ score.external_url }}" target="_blank">
                                <div class="scoring-source .details">
                                    <img class="scoring-source-logo" src="/static/web/img/information_sources/{{ score.source_name }}.png">
                                    <h6 class="scoring-source-value">{{ score.value }}</h6>
                                </div>
                            </a>
                        {% endfor %}
                    </div>

                </div>

            <br>
            </div>
            <div class="filmcard-wrapper col-sm-7">

                <!-- Youtube trailer -->
                <div class="filmcard-title">
                    <h1>Trailer:</h1>
                </div>

                <div class="filmcard">
                    <div class="filmcard-body">
                        <div class="trailer-container" style="background-image: linear-gradient(#fff, #999);">

                            {% if audiovisual_record.metadata.trailers.youtube %}
                            <iframe class="trailer-iframe" frameBorder="0"
                                    allowfullscreen
                                    style="position:absolute;top:0;left:0;width:100%;height:100%;"
                                    src="{{ audiovisual_record.metadata.trailers.youtube }}">
                            </iframe>
                            {% else %}
                            <div class="trailer-iframe">
                                <p style="color: white; text-align: center;"><small>Not available. Sorry :-(</small></p>
                            </div>
                            {% endif %}

                        </div>
                    </div>
                    <div class="filmcard-footer">
                        <hr>
                        <p>Source YouTube</p>
                    </div>
                </div>

            <br>
            </div>
        </div>
{#        <br>#}
{#        <div class="text-center">#}
{#            <a href="javascript:history.back()" class="btn btn-secondary"><i class="fa fa-arrow-left" aria-hidden="true"></i> Go Back</a>#}
{#        </div>#}
        <div class="row">
                    <!-- Download sources -->
            <div class="filmcard-wrapper col-sm-12">
                <div class="filmcard-title">
                    <h1>Download Sources</h1>
                </div>
                <div class="filmcard downloads">

                    <ul class="nav nav-tabs justify-content-center" id="language-tabs">
                        {% for lang, downloads, translation in  lang_downloads %}
                        <li class="text-center"><a data-toggle="tab" id="tab{{ forloop.counter }}" href="#menu{{ forloop.counter }}">{{ translation }}</a></li>
                        {% endfor %}
                    </ul>

                    <div class="tab-content">
                        {% for lang, downloads, translation in  lang_downloads %}
                        <div id="menu{{ forloop.counter }}" class="tab-pane fade{% if forloop.counter == 0 %} in active{% endif %}">
                            <table class="downloads-table table table-borderless downloads-table-big-screens">
                                <thead>
                                    <tr>
                                        <td class="text-center"><b>Quality</b></td>
                                        <td class="text-center"><b>Language</b></td>
                                        <td class="text-center"><b>Source</b></td>
                                        <td class="text-center"><b>Name</b></td>
                                        {% if request.user.is_superuser %}<td><b>Remove</b></td>{% endif %}
                                    </tr>
                                </thead>
                                <tbody class="table-hover">

                                {% for download in downloads %}
                                    <tr>
                                        <td class="text-center" onclick="window.open('{{ download.source_base_url_plus_relative_link }}', target='_blank');">{{ download.quality }}</td>
                                        <td class="text-center" onclick="window.open('{{ download.source_base_url_plus_relative_link }}', target='_blank');"><img style="width: 1.5em; height: 1.5em;" src="/static/web/img/languages/{{ download.lang }}.png"></td>
                                        <td class="text-center" onclick="window.open('{{ download.source_base_url_plus_relative_link }}', target='_blank');">{{ download.source_name }}</td>
                                        <td onclick="window.open('{{ download.source_base_url_plus_relative_link }}', target='_blank');">{{ download.name }}</td>
                                        {% if request.user.is_superuser %}
                                        <td>
                                            <a href="#" onclick="removeDownloadLink('{{ download.id }}');" style="color: white;" class="btn btn-secondary">Remove</a>
                                        </td>
                                        {% endif %}
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                            <div class="downloads-table-small-screens">
                                <br>
                                {% for download in downloads %}
                                <div class="download-element-container">
                                    <p><span>Download:</span><a class="secondary" href="{{ download.source_base_url_plus_relative_link }}" target="_blank"> {{ download.name }}</a></p>
                                    <p><span>Quality:</span> {{ download.quality }}</p>
                                    <p><span>Source Language:</span> <img style="width: 1.5em; height: 1.5em;" src="/static/web/img/languages/{{ download.lang }}.png"></p>
                                    <p><span>Source:</span> {{ download.source_name }}</p>
                                    {% if request.user.is_superuser %}
                                    <p><a href="#" onclick="removeDownloadLink('{{ download.id }}');" style="color: white;" class="btn btn-secondary">Remove</a></p>
                                    {% endif %}
                                    {% if not forloop.last %}
                                    <hr>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>

                        </div>
                        {% endfor %}
                    </div>

                </div>
            </div>

        </div>
        <br>


        <br>
        <br>
        <div class="text-center">
        {% include 'web/fragment_social_links.html'  with text=audiovisual_record.name|add:' Downloads' url=request.build_absolute_uri %}
        </div>

        <br>

        {% if related_records %}
        <br>
        <br>
        <div class="text-center">
        <h3>Related:</h3>
        {% for audiovisual_item in related_records %}
            {% include 'web/fragment_audiovisual_item.html' with ai=audiovisual_item %}
        {% endfor %}
        </div>
        {% endif %}
    </div>
{% endblock %}

{% block body_extra_js %}
    {{ block.super }}
    <script>
    $(document).ready(function() {
        $("#tab1").click();
        if(document.getElementById("tab2") === null) {
            $("#language-tabs").hide();
        }
    });
    </script>
    {% if request.user.is_superuser %}
    <script>
    function removeFilm(pk) {
        if(window.confirm('Are you sure to remove this film?')) {
            window.location.href = '/remove-film/' + pk + '/';
        }
    }
    function removeDownloadLink(pk) {
        if(window.confirm('Are you sure to remove this link?')) {
            window.location.href = '/remove-download/' + pk + '/';
        }
    }
    </script>
    {% endif %}
{% endblock %}
